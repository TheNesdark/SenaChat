---
import { actions } from 'astro:actions';
import { isInputError } from 'astro:actions';

const result = Astro.getActionResult(actions.register);

if (result && !result.error) {
  return Astro.redirect('/login');
}

const inputErrors = result?.error && isInputError(result.error) ? result.error.fields : {};
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<title>Register - SenaChat</title>
	</head>
	<body>
		<section class="register">
            <h1>Register</h1>
			<form class="register-form" method="POST" action={actions.register}>
                <label for="name">Name</label>
				<input type="text" id="name" name="name" required aria-describedby="name-error" />
                {inputErrors.name && <p id="name-error" style="color: red; font-size: 0.8em;">{inputErrors.name.join(', ')}</p>}

				<label for="email">Email</label>
				<input type="email" id="email" name="email" required aria-describedby="email-error" />
                {inputErrors.email && <p id="email-error" style="color: red; font-size: 0.8em;">{inputErrors.email.join(', ')}</p>}

				<label for="password">Password</label>
				<input type="password" id="password" name="password" required aria-describedby="password-error" />
                {inputErrors.password && <p id="password-error" style="color: red; font-size: 0.8em;">{inputErrors.password.join(', ')}</p>}

				<button type="submit">Register</button>
                
                {result?.error && !isInputError(result.error) && (
                    <p style="color: red; margin-top: 10px;">{result.error.message}</p>
                )}
			</form>
            <p class="login-register">Already have an account? <a href="/login">Login</a></p>
		</section>
	</body>
</html>

<style>
	html,
	body {
		margin: 0;
		width: 100%;
		height: 100%;
		display: flex;
		align-items: center;
		justify-content: center;
        font-family: system-ui, sans-serif;
	}

    .register-form {
        display: flex;
        flex-direction: column;
        justify-content: center;
        width: 300px;
    }
    .register-form label {
        margin-top: 10px;
    }
    .register-form button {
        margin-top: 20px;
        padding: 10px;
        cursor: pointer;
    }

    .login-register {
        margin-top: 10px;
        text-align: center;
    }
</style>

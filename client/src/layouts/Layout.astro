---
const { user } = Astro.locals;
const initial = user?.name ? user.name.charAt(0).toUpperCase() : "U";
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<title>Astro Basics</title>
	</head>
	<body>
		<header class="app-header">
			<h1>SenaChat</h1>
			{
				user && (
					<div class="user-menu">
						<button id="avatar-btn" class="avatar">
							{initial}
						</button>
						<div id="dropdown" class="dropdown-content hidden">
							<div class="user-info">
								<p class="user-name">
									{user.name || "Usuario"}
								</p>
								<p class="user-email">{user.email}</p>
							</div>
							<hr />
							<a href="/profile">Perfil</a>
							<a href="/logout" class="logout-btn">
								Cerrar Sesi√≥n
							</a>
						</div>
					</div>
				)
			}
		</header>
		<slot />

		<script>
			const avatarBtn = document.getElementById("avatar-btn");
			const dropdown = document.getElementById("dropdown");

			if (avatarBtn && dropdown) {
				avatarBtn.addEventListener("click", (e) => {
					e.stopPropagation();
					dropdown.classList.toggle("hidden");
				});

				document.addEventListener("click", () => {
					if (!dropdown.classList.contains("hidden")) {
						dropdown.classList.add("hidden");
					}
				});

				dropdown.addEventListener("click", (e) => {
					e.stopPropagation();
				});
			}
		</script>
	</body>
</html>

<style is:global>
	html,
	body {
		margin: 0;
		width: 100%;
		height: 100%;
		font-family:
			system-ui,
			-apple-system,
			sans-serif;
	}
</style>

<style>
	.app-header {
		display: flex;
		justify-content: space-between;
		background-color: #1e293b; /* Darker, richer background */
		color: #f8fafc;
		padding: 0.75rem 1.5rem;
		align-items: center;
		box-shadow:
			0 4px 6px -1px rgba(0, 0, 0, 0.1),
			0 2px 4px -1px rgba(0, 0, 0, 0.06);
		position: sticky;
		top: 0;
		z-index: 50;
	}

	.app-header h1 {
		margin: 0;
		font-size: 1.25rem;
		font-weight: 700;
		letter-spacing: -0.025em;
		background: linear-gradient(to right, #818cf8, #c084fc);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
	}

	.user-menu {
		position: relative;
	}

	.avatar {
		width: 40px;
		height: 40px;
		border-radius: 50%;
		background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
		color: white;
		border: 2px solid rgba(255, 255, 255, 0.2);
		font-weight: 600;
		font-size: 1rem;
		cursor: pointer;
		display: flex;
		align-items: center;
		justify-content: center;
		transition: all 0.2s ease;
		box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
	}

	.avatar:hover {
		transform: translateY(-1px);
		box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
		border-color: rgba(255, 255, 255, 0.5);
	}

	.avatar:active {
		transform: translateY(0);
	}

	.dropdown-content {
		position: absolute;
		right: 0;
		top: calc(100% + 0.75rem);
		background-color: white;
		color: #1e293b;
		min-width: 240px;
		box-shadow:
			0 10px 15px -3px rgba(0, 0, 0, 0.1),
			0 4px 6px -2px rgba(0, 0, 0, 0.05);
		border-radius: 12px;
		z-index: 100;
		overflow: hidden;
		text-align: left;
		border: 1px solid #e2e8f0;
		opacity: 1;
		transform: translateY(0);
		transition:
			opacity 0.15s ease,
			transform 0.15s ease;
		transform-origin: top right;
	}

	.dropdown-content.hidden {
		display: none; /* Keep display none for accessibility/layout, but we could animate opacity if we removed this */
		opacity: 0;
		transform: translateY(-10px);
	}

	/* Override hidden for animation if we were using JS to toggle classes differently, 
       but for now simple display toggle is safer with current JS. 
       Let's keep the nice styling even if animation is simple. */

	.user-info {
		padding: 1.25rem;
		background-color: #f8fafc;
		border-bottom: 1px solid #e2e8f0;
	}

	.user-name {
		font-weight: 600;
		font-size: 0.95rem;
		margin: 0;
		color: #0f172a;
	}

	.user-email {
		font-size: 0.8rem;
		color: #64748b;
		margin: 4px 0 0 0;
		white-space: nowrap;
		overflow: hidden;
		text-overflow: ellipsis;
	}

	hr {
		margin: 0;
		border: none;
		border-top: 1px solid #e2e8f0;
	}

	.dropdown-content a {
		color: #334155;
		padding: 0.75rem 1.25rem;
		text-decoration: none;
		display: flex;
		align-items: center;
		font-size: 0.9rem;
		transition:
			background-color 0.15s ease,
			color 0.15s ease;
	}

	.dropdown-content a:hover {
		background-color: #f1f5f9;
		color: #0f172a;
	}

	.logout-btn {
		color: #ef4444 !important;
	}

	.logout-btn:hover {
		background-color: #fef2f2 !important;
		color: #dc2626 !important;
	}
</style>
